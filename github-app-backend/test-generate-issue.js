import axios from "axios";

const SERVER_URL = "http://localhost:3001/generate-issue";

const payload = {
  repository: {
    owner: "Vbraniumlads",
    name: "vibetorch",
  },
  installation_id: 79416455,
  issue: {
    title: "Auto-Generated Issue from Claude Bot",
    body: `# Automated Issue Creation Test

This issue was automatically generated by the Claude Todo GitHub App webhook.

@claude can you help me understand this codebase?

---
*Generated automatically by VibeTorch - ${new Date().toISOString()}*`,
    labels: ["bot-generated", "test"],
    assignees: [],
  },
};

try {
  console.log("ğŸš€ Triggering issue generation...");
  console.log(
    "ğŸ“‹ Target repository:",
    payload.repository.owner + "/" + payload.repository.name
  );
  console.log("ğŸ“‹ Issue title:", payload.issue.title);

  const response = await axios.post(SERVER_URL, payload, {
    headers: {
      "Content-Type": "application/json",
    },
  });

  console.log("âœ… Issue generation successful!");
  console.log("ğŸ“Š Response:", response.status);
  console.log("ğŸ“‹ Issue details:", response.data.issue);
  console.log("ğŸ”— Issue URL:", response.data.issue.url);
} catch (error) {
  console.error(
    "âŒ Issue generation failed:",
    error.response?.data || error.message
  );
  if (error.response) {
    console.error("ğŸ“Š Status:", error.response.status);
    console.error("ğŸ“‹ Response:", error.response.data);
  }
}
